<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè≠ Smart Warehouse Dashboard ‚Äî –∑–∞—â–∏—â—ë–Ω–Ω—ã–π —Ä–µ–∂–∏–º</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg,#667eea 0%,#764ba2 100%); min-height:100vh; display:flex; justify-content:center; align-items:center; padding:20px; }
        .container { width:100%; max-width:1400px; background:rgba(255,255,255,0.95); border-radius:20px; box-shadow:0 20px 60px rgba(0,0,0,0.3); overflow:hidden; }
        .header { background:linear-gradient(135deg,#0d6efd 0%,#0b5ed7 100%); color:white; padding:30px 40px; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:20px; }
        .header-left h1 { font-size:28px; margin-bottom:10px; display:flex; align-items:center; gap:15px; }
        .header-left p { font-size:16px; opacity:0.95; }
        .stats { display:flex; gap:30px; background:rgba(255,255,255,0.2); padding:15px 25px; border-radius:15px; backdrop-filter: blur(10px); }
        .stat-item { text-align:center; }
        .stat-value { font-size:28px; font-weight:bold; display:block; }
        .stat-label { font-size:14px; opacity:0.9; }
        .main-content { display:grid; grid-template-columns:300px 1fr; min-height:700px; }
        .sidebar { background:linear-gradient(180deg,#2d3748 0%,#1a202c 100%); padding:30px 20px; color:white; }
        .sidebar-section { margin-bottom:30px; }
        .sidebar-section h3 { color:#63b3ed; font-size:14px; text-transform:uppercase; letter-spacing:1px; margin-bottom:20px; padding-bottom:10px; border-bottom:2px solid rgba(99,179,237,0.3); }
        .form-group { margin-bottom:20px; }
        .form-group label { display:block; font-size:14px; margin-bottom:8px; color:#a0aec0; }
        .form-control { width:100%; padding:12px 15px; background:rgba(255,255,255,0.1); border:2px solid rgba(255,255,255,0.2); border-radius:10px; color:white; font-size:14px; transition:all 0.3s; }
        .form-control:focus { outline:none; border-color:#63b3ed; background:rgba(255,255,255,0.15); }
        .btn { display:flex; align-items:center; justify-content:center; gap:10px; width:100%; padding:15px; border:none; border-radius:10px; font-size:15px; font-weight:600; cursor:pointer; transition:all 0.3s; margin-bottom:15px; }
        .btn:hover { transform:translateY(-2px); box-shadow:0 5px 15px rgba(0,0,0,0.2); }
        .btn-primary { background:linear-gradient(135deg,#48bb78 0%,#38a169 100%); color:white; }
        .btn-warning { background:linear-gradient(135deg,#ed8936 0%,#dd6b20 100%); color:white; }
        .btn-danger { background:linear-gradient(135deg,#f56565 0%,#e53e3e 100%); color:white; }
        .btn-secondary { background:linear-gradient(135deg,#4299e1 0%,#3182ce 100%); color:white; }
        .products-panel { padding:30px; background:#f7fafc; }
        .panel-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; flex-wrap:wrap; gap:20px; }
        .panel-header h2 { font-size:24px; color:#2d3748; }
        .search-box { position:relative; width:300px; }
        .search-box input { width:100%; padding:12px 15px 12px 45px; border:2px solid #e2e8f0; border-radius:10px; font-size:14px; transition:all 0.3s; }
        .search-box input:focus { outline:none; border-color:#4299e1; box-shadow:0 0 0 3px rgba(66,153,225,0.1); }
        .search-box i { position:absolute; left:15px; top:50%; transform:translateY(-50%); color:#a0aec0; }
        .products-table { background:white; border-radius:15px; overflow:hidden; box-shadow:0 5px 20px rgba(0,0,0,0.1); }
        .table-header { background:linear-gradient(135deg,#edf2f7 0%,#e2e8f0 100%); padding:20px; display:grid; grid-template-columns:80px 1fr 120px 150px 120px 150px; gap:15px; font-weight:600; color:#4a5568; border-bottom:2px solid #e2e8f0; }
        .table-row { padding:20px; display:grid; grid-template-columns:80px 1fr 120px 150px 120px 150px; gap:15px; align-items:center; border-bottom:1px solid #edf2f7; transition:all 0.3s; }
        .table-row:hover { background:#f8fafc; }
        .table-row:last-child { border-bottom:none; }
        .low-stock { background:linear-gradient(90deg, rgba(254,215,215,0.2) 0%, transparent 100%); border-left:4px solid #fc8181; }
        .product-id { font-weight:600; color:#4a5568; }
        .product-name { font-weight:600; color:#2d3748; }
        .product-category { background:#e6fffa; color:#234e52; padding:5px 12px; border-radius:20px; font-size:13px; text-align:center; font-weight:500; display:inline-block; }
        .product-price { font-weight:bold; color:#2f855a; font-size:16px; }
        .product-quantity { font-weight:bold; font-size:16px; }
        .quantity-low { color:#c53030; }
        .quantity-normal { color:#2d3748; }
        .table-actions { display:flex; gap:10px; }
        .action-btn { padding:8px 15px; border:none; border-radius:8px; font-size:13px; font-weight:600; cursor:pointer; transition:all 0.3s; }
        .action-btn:hover { transform:translateY(-1px); }
        .btn-reduce { background:#fed7d7; color:#c53030; }
        .btn-delete { background:#fff5f5; color:#e53e3e; }
        .btn-edit { background:#e6f4ff; color:#0b5ed7; }
        .status-bar { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:white; padding:15px 30px; border-radius:50px; box-shadow:0 10px 30px rgba(0,0,0,0.2); display:flex; align-items:center; gap:15px; z-index:1000; min-width:300px; max-width:90%; }
        .status-icon { font-size:20px; }
        .status-text { font-size:14px; font-weight:500; }
        .status-success { color:#38a169; }
        .status-loading { color:#3182ce; }
        .status-error { color:#e53e3e; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
        .fade-in { animation:fadeIn 0.5s ease-out; }
        @keyframes pulse { 0%,100%{opacity:1;} 50%{opacity:0.5;} }
        .pulse { animation:pulse 2s infinite; }
        @media (max-width:1200px) { .main-content { grid-template-columns:1fr; } .sidebar { border-radius:15px 15px 0 0; } }
        @media (max-width:768px) {
            .header { flex-direction:column; text-align:center; }
            .stats { width:100%; justify-content:center; }
            .panel-header { flex-direction:column; }
            .search-box { width:100%; }
            .table-header, .table-row { grid-template-columns:1fr; gap:10px; padding:15px; }
            .table-header { display:none; }
            .table-cell { display:flex; justify-content:space-between; padding:5px 0; }
            .table-cell::before { content: attr(data-label); font-weight:600; color:#4a5568; }
        }

        /* Unlock floating button */
        .unlock-btn {
            position: fixed;
            right: 24px;
            bottom: 24px;
            z-index: 1500;
            background: linear-gradient(135deg,#ffd166 0%,#f7b267 100%);
            color: #1a202c;
            padding: 12px 18px;
            border-radius: 12px;
            font-weight:700;
            cursor:pointer;
            box-shadow:0 10px 30px rgba(0,0,0,0.2);
            display:flex;
            align-items:center;
            gap:10px;
        }
        .unlock-btn.locked { background: linear-gradient(135deg,#cbd5e1 0%,#94a3b8 100%); color:#1a202c; }
        .small-muted { font-size:12px; color:#718096; margin-top:6px; }

        /* Modals (generic) */
        .modal-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:2000; justify-content:center; align-items:center; padding:20px; }
        .modal-card { background:white; padding:20px; border-radius:12px; width:100%; max-width:520px; box-shadow:0 10px 40px rgba(0,0,0,0.2); }
        .modal-header { margin-bottom:12px; font-size:18px; font-weight:700; color:#2d3748; display:flex; justify-content:space-between; align-items:center; gap:12px; }
        .modal-row { margin-bottom:12px; }
        .modal-actions { display:flex; gap:12px; margin-top:14px; }
        .floating-edit-indicator { position: fixed; left: 24px; bottom: 24px; z-index: 1500; background: white; padding: 10px 14px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); font-weight:700; color:#2d3748; }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <h1><i class="fas fa-warehouse"></i> –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–ö–õ–ê–î–û–ú</h1>
                <p>–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–Ω—ã–º–∏ –∑–∞–ø–∞—Å–∞–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏</p>
            </div>
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-value" id="totalProducts">0</span>
                    <span class="stat-label">–í—Å–µ–≥–æ —Ç–æ–≤–∞—Ä–æ–≤</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="lowStock">0</span>
                    <span class="stat-label">–ù–∏–∑–∫–∏–π –∑–∞–ø–∞—Å</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="totalValue">0</span>
                    <span class="stat-label">–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (—Å–æ–º)</span>
                </div>
            </div>
        </div>

        <!-- Main -->
        <div class="main-content">
            <!-- Sidebar -->
            <div class="sidebar">
                <div class="sidebar-section">
                    <h3>–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä</h3>
                    <div class="form-group">
                        <label for="productName"><i class="fas fa-tag"></i> –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</label>
                        <input type="text" id="productName" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ" disabled>
                    </div>
                    <div class="form-group">
                        <label for="productQuantity"><i class="fas fa-boxes"></i> –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                        <input type="number" id="productQuantity" class="form-control" value="1" min="1" disabled>
                    </div>
                    <div class="form-group">
                        <label for="productCategory"><i class="fas fa-layer-group"></i> –ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                        <select id="productCategory" class="form-control" disabled>
                            <option value="–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞">–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞</option>
                            <option value="–û–¥–µ–∂–¥–∞">–û–¥–µ–∂–¥–∞</option>
                            <option value="–ü—Ä–æ–¥—É–∫—Ç—ã">–ü—Ä–æ–¥—É–∫—Ç—ã</option>
                            <option value="–ö–Ω–∏–≥–∏">–ö–Ω–∏–≥–∏</option>
                            <option value="–°–ø–æ—Ä—Ç">–°–ø–æ—Ä—Ç</option>
                            <option value="–î—Ä—É–≥–æ–µ">–î—Ä—É–≥–æ–µ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="productPrice"><i class="fas fa-money-bill-wave"></i> –¶–µ–Ω–∞ (—Å–æ–º)</label>
                        <input type="number" id="productPrice" class="form-control" value="0" min="0" step="0.01" disabled>
                    </div>
                    <button id="btnAdd" class="btn btn-primary" onclick="addProduct()" disabled>
                        <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
                    </button>
                    <div class="small-muted">–î–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∫–ª—é—á–∏—Ç–µ —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (–∫–Ω–æ–ø–∫–∞ —Å–ø—Ä–∞–≤–∞ –≤–Ω–∏–∑—É).</div>
                </div>

                <div class="sidebar-section">
                    <h3>–î–µ–π—Å—Ç–≤–∏—è</h3>
                    <button id="btnRefresh" class="btn btn-secondary" onclick="loadProducts()">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
                    </button>
                    <button id="btnReduce" class="btn btn-warning" onclick="showReduceModal()" disabled>
                        <i class="fas fa-arrow-down"></i> –°–ø–∏—Å–∞—Ç—å —Ç–æ–≤–∞—Ä
                    </button>
                    <button id="btnDelete" class="btn btn-danger" onclick="showDeleteModal()" disabled>
                        <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä
                    </button>
                </div>

                <div class="sidebar-section">
                    <h3>–ü–æ–∏—Å–∫</h3>
                    <div class="form-group">
                        <input type="text" id="searchInput" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞...">
                    </div>
                </div>
            </div>

            <!-- Products panel -->
            <div class="products-panel">
                <div class="panel-header">
                    <h2><i class="fas fa-box-open"></i> –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</h2>
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchBox" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é...">
                    </div>
                </div>

                <div class="products-table">
                    <div class="table-header">
                        <div>ID</div>
                        <div>–ù–ê–ó–í–ê–ù–ò–ï</div>
                        <div>–ö–û–õ–ò–ß–ï–°–¢–í–û</div>
                        <div>–ö–ê–¢–ï–ì–û–†–ò–Ø</div>
                        <div>–¶–ï–ù–ê</div>
                        <div>–î–ï–ô–°–¢–í–ò–Ø</div>
                    </div>
                    <div id="productsList">
                        <div class="table-row" style="text-align:center; padding:40px; color:#a0aec0;">
                            <div style="grid-column:1 / -1;">
                                <i class="fas fa-spinner fa-spin fa-2x" style="margin-bottom:20px;"></i>
                                <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Status -->
    <div class="status-bar" id="statusBar" style="display:none;">
        <div class="status-icon" id="statusIcon"></div>
        <div class="status-text" id="statusText"></div>
    </div>

    <!-- Reduce modal -->
    <div id="reduceModal" class="modal-overlay" onclick="overlayClick(event)">
        <div class="modal-card" role="dialog" aria-modal="true">
            <div class="modal-header"><div><i class="fas fa-arrow-down"></i> –°–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞</div><div id="reduceModalClose" style="cursor:pointer;" onclick="closeModals()">‚úï</div></div>
            <div class="modal-row">
                <label>–¢–æ–≤–∞—Ä: <span id="reduceProductName"></span></label>
            </div>
            <div class="modal-row">
                <label for="reduceQuantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è</label>
                <input type="number" id="reduceQuantity" class="form-control" value="1" min="1">
            </div>
            <div class="modal-actions">
                <button class="btn btn-warning" onclick="performReduce()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                <button class="btn" onclick="closeModals()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- Delete modal -->
    <div id="deleteModal" class="modal-overlay" onclick="overlayClick(event)">
        <div class="modal-card" role="dialog" aria-modal="true">
            <div class="modal-header"><div><i class="fas fa-exclamation-triangle" style="color:#e53e3e;"></i> –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</div><div style="cursor:pointer;" onclick="closeModals()">‚úï</div></div>
            <div class="modal-row">
                <p id="deleteMessage" style="color:#4a5568;"></p>
            </div>
            <div class="modal-actions">
                <button class="btn btn-danger" onclick="performDelete()">–£–¥–∞–ª–∏—Ç—å</button>
                <button class="btn" onclick="closeModals()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- Unlock modal -->
    <div id="unlockModal" class="modal-overlay" onclick="overlayClick(event)">
        <div class="modal-card" role="dialog" aria-modal="true">
            <div class="modal-header"><div><i class="fas fa-user-lock"></i> –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</div><div style="cursor:pointer;" onclick="closeUnlockModal()">‚úï</div></div>
            <div class="modal-row">
                <label for="authName">–ò–º—è</label>
                <input type="text" id="authName" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
            </div>
            <div class="modal-row">
                <label for="authPass">–ü–∞—Ä–æ–ª—å</label>
                <input type="password" id="authPass" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="tryUnlock()">–í–æ–π—Ç–∏</button>
                <button class="btn" onclick="closeUnlockModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
            <div class="small-muted" style="margin-top:8px;"></div>
        </div>
    </div>

    <!-- Edit modal -->
    <div id="editModal" class="modal-overlay" onclick="overlayClick(event)">
        <div class="modal-card" role="dialog" aria-modal="true">
            <div class="modal-header"><div><i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–≤–∞—Ä</div><div style="cursor:pointer;" onclick="closeEditModal()">‚úï</div></div>
            <div class="modal-row">
                <label for="editName">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                <input type="text" id="editName" class="form-control">
            </div>
            <div class="modal-row">
                <label for="editQuantity">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</label>
                <input type="number" id="editQuantity" class="form-control" min="0">
            </div>
            <div class="modal-row">
                <label for="editCategory">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                <input type="text" id="editCategory" class="form-control">
            </div>
            <div class="modal-row">
                <label for="editPrice">–¶–µ–Ω–∞ (—Å–æ–º)</label>
                <input type="number" id="editPrice" class="form-control" step="0.01" min="0">
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" onclick="performEdit()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="btn" onclick="closeEditModal()">–û—Ç–º–µ–Ω–∞</button>
            </div>
        </div>
    </div>

    <!-- Floating unlock button -->
    <div id="unlockFloating" class="unlock-btn locked" onclick="openUnlockModal()">
        <i class="fas fa-lock"></i> –†–µ–∂–∏–º —Ä–µ–¥.
    </div>

    <!-- Edit mode indicator -->
    <div id="editIndicator" class="floating-edit-indicator" style="display:none;">
        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: ON
    </div>

    <script>
        const API_URL = 'http://localhost:3002/api/products'; // –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–º–µ–Ω—è–π
        let selectedProductId = null;
        let selectedProductName = null;
        let allProducts = [];
        let isUnlocked = false; // —Ñ–ª–∞–≥ —Ä–µ–∂–∏–º–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        const AUTH_NAME = 'vladik';
        const AUTH_PASS = 'rdwx174291';

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            loadProducts();
            document.getElementById('searchBox').addEventListener('input', filterProducts);
            document.getElementById('searchInput').addEventListener('input', filterProducts);
            updateUIState();
            // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            setInterval(() => {
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –≤–≤–µ–¥–µ–Ω–∏–∏ –ø–∞—Ä–æ–ª—è ‚Äî –∏–Ω–∞—á–µ –Ω–µ –ª–æ–º–∞–µ–º UX
                loadProducts();
            }, 30000);
        });

        // UI state (–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫) –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç isUnlocked
        function updateUIState() {
            const controls = [
                'productName','productQuantity','productCategory','productPrice','btnAdd','btnReduce','btnDelete'
            ];
            controls.forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                if (isUnlocked) {
                    el.removeAttribute('disabled');
                } else {
                    el.setAttribute('disabled','true');
                }
            });

            const unlockBtn = document.getElementById('unlockFloating');
            const indicator = document.getElementById('editIndicator');
            if (isUnlocked) {
                unlockBtn.classList.remove('locked');
                unlockBtn.innerHTML = '<i class="fas fa-unlock"></i> –†–µ–∂–∏–º —Ä–µ–¥.';
                indicator.style.display = 'block';
            } else {
                unlockBtn.classList.add('locked');
                unlockBtn.innerHTML = '<i class="fas fa-lock"></i> –†–µ–∂–∏–º —Ä–µ–¥.';
                indicator.style.display = 'none';
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤
        async function loadProducts() {
            showStatus('‚è≥ –ó–∞–≥—Ä—É–∂–∞—é –¥–∞–Ω–Ω—ã–µ —Å —Å–µ—Ä–≤–µ—Ä–∞...', 'loading');
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                const result = await response.json();
                if (result.success || Array.isArray(result)) {
                    // API –º–æ–∂–µ—Ç —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –º–∞—Å—Å–∏–≤ –∏–ª–∏ –æ–±—ä–µ–∫—Ç { success, data }
                    const data = result.success ? result.data : (result.data || result);
                    allProducts = data;
                    displayProducts(data);
                    updateStatistics(data);
                    const count = Array.isArray(data) ? data.length : (result.count || 0);
                    showStatus(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${count} —Ç–æ–≤–∞—Ä–æ–≤ | ${new Date().toLocaleTimeString()}`, 'success');
                } else {
                    throw new Error(result.message || '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                }
            } catch (error) {
                showStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                // –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫
                displayProducts([]);
                updateStatistics([]);
            }
        }

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
        function displayProducts(products) {
            const container = document.getElementById('productsList');
            container.innerHTML = '';

            if (!products || products.length === 0) {
                container.innerHTML = `
                    <div class="table-row" style="text-align:center; padding:40px; color:#a0aec0;">
                        <div style="grid-column:1 / -1;">
                            <i class="fas fa-box-open fa-2x" style="margin-bottom:20px;"></i>
                            <p>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                        </div>
                    </div>
                `;
                return;
            }

            products.forEach(product => {
                const isLowStock = Number(product.quantity) < 10;
                const idDisplay = product._id ? product._id.substring(0,8) : (product.id || '‚Äî');
                const priceDisplay = (product.price !== undefined && product.price !== null) ? Number(product.price).toFixed(2) : '0.00';
                const row = document.createElement('div');
                row.className = `table-row fade-in ${isLowStock ? 'low-stock' : ''}`;
                // –£–¥–∞–ª—è–µ–º XSS-—Ä–∏—Å–∫–∏ ‚Äî —ç–∫—Ä–∞–Ω–∏—Ä—É–µ–º –≤—ã–≤–æ–¥ (–ø—Ä–æ—Å—Ç–∞—è —ç–∫—Ä–∞–Ω–∏–∑–∞—Ü–∏—è)
                const safe = txt => String(txt).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
                row.innerHTML = `
                    <div class="product-id">#${safe(idDisplay)}</div>
                    <div class="product-name">${safe(product.name)}</div>
                    <div class="product-quantity ${isLowStock ? 'quantity-low' : 'quantity-normal'}">${safe(product.quantity)} —à—Ç</div>
                    <div class="product-category">${safe(product.category)}</div>
                    <div class="product-price">${safe(priceDisplay)} —Å–æ–º</div>
                    <div class="table-actions" id="actions-${safe(idDisplay)}">
                        <button class="action-btn btn-reduce" onclick="prepareReduce('${product._id || product.id}','${safe(product.name)}')" ${isUnlocked ? '' : 'disabled'}>
                            <i class="fas fa-arrow-down"></i> –°–ø–∏—Å–∞—Ç—å
                        </button>
                        <button class="action-btn btn-delete" onclick="prepareDelete('${product._id || product.id}','${safe(product.name)}')" ${isUnlocked ? '' : 'disabled'}>
                            <i class="fas fa-trash"></i> –£–¥–∞–ª–∏—Ç—å
                        </button>
                        <button class="action-btn btn-edit" onclick="prepareEdit('${product._id || product.id}')" ${isUnlocked ? '' : 'disabled'}>
                            <i class="fas fa-edit"></i> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                    </div>
                `;
                // –¥–æ–±–∞–≤–∏–º data-–∞—Ç—Ä–∏–±—É—Ç —Å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º –æ–±—ä–µ–∫—Ç–æ–º –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ (–±–µ–∑–æ–ø–∞—Å–Ω–æ: JSON)
                row.dataset.product = JSON.stringify(product);
                container.appendChild(row);
            });
        }

        // –ü–æ–∏—Å–∫
        function filterProducts() {
            const searchText = (document.getElementById('searchBox').value || document.getElementById('searchInput').value || '').toLowerCase();
            const filtered = allProducts.filter(product => (product.name || '').toString().toLowerCase().includes(searchText));
            displayProducts(filtered);
            updateStatistics(filtered);
        }

        // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        function updateStatistics(products) {
            const totalProducts = products.length;
            const lowStock = products.filter(p => Number(p.quantity) < 10).length;
            const totalValue = products.reduce((sum, p) => sum + (Number(p.price || 0) * Number(p.quantity || 0)), 0);
            document.getElementById('totalProducts').textContent = totalProducts;
            document.getElementById('lowStock').textContent = lowStock;
            document.getElementById('totalValue').textContent = totalValue.toFixed(2);
        }

        // –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ unlocked)
        async function addProduct() {
            if (!isUnlocked) { showStatus('‚ùå –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω', 'error'); return; }
            const name = document.getElementById('productName').value.trim();
            const quantity = parseInt(document.getElementById('productQuantity').value);
            const category = document.getElementById('productCategory').value;
            const price = parseFloat(document.getElementById('productPrice').value);

            if (!name) { showStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞', 'error'); return; }
            if (isNaN(quantity) || quantity <= 0) { showStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ', 'error'); return; }
            if (isNaN(price) || price < 0) { showStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É', 'error'); return; }

            showStatus('‚è≥ –û—Ç–ø—Ä–∞–≤–ª—è—é –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä...', 'loading');
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, quantity, category, price })
                });
                if (!response.ok) {
                    const err = await response.json().catch(()=>({}));
                    throw new Error(err.message || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏');
                }
                const result = await response.json();
                if (result.success) {
                    showStatus('‚úÖ –¢–æ–≤–∞—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', 'success');
                    // –°–±—Ä–æ—Å —Ñ–æ—Ä–º—ã
                    document.getElementById('productName').value = '';
                    document.getElementById('productQuantity').value = '1';
                    document.getElementById('productPrice').value = '0';
                    loadProducts();
                } else {
                    throw new Error(result.message || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }
            } catch (error) {
                showStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–ø–∏—Å–∞–Ω–∏—è
        function prepareReduce(id, name) {
            if (!isUnlocked) { showStatus('‚ùå –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω', 'error'); return; }
            selectedProductId = id;
            selectedProductName = name;
            document.getElementById('reduceProductName').textContent = name;
            document.getElementById('reduceQuantity').value = '1';
            openModal('reduceModal');
        }

        // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è
        function prepareDelete(id, name) {
            if (!isUnlocked) { showStatus('‚ùå –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω', 'error'); return; }
            selectedProductId = id;
            selectedProductName = name;
            document.getElementById('deleteMessage').textContent = `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä "${name}"? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`;
            openModal('deleteModal');
        }

        // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        function prepareEdit(id) {
            if (!isUnlocked) { showStatus('‚ùå –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω', 'error'); return; }
            // –ù–∞—Ö–æ–¥–∏–º –æ–±—ä–µ–∫—Ç –≤ allProducts
            const product = allProducts.find(p => (p._id === id) || (String(p.id) === String(id)));
            if (!product) {
                showStatus('‚ùå –¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Å–ø–∏—Å–∫–µ', 'error');
                return;
            }
            selectedProductId = id;
            document.getElementById('editName').value = product.name || '';
            document.getElementById('editQuantity').value = product.quantity || 0;
            document.getElementById('editCategory').value = product.category || '';
            document.getElementById('editPrice').value = product.price || 0;
            openModal('editModal');
        }

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å–ø–∏—Å–∞–Ω–∏—è
        async function performReduce() {
            if (!isUnlocked) { showStatus('‚ùå –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω', 'error'); closeModals(); return; }
            const quantity = parseInt(document.getElementById('reduceQuantity').value);
            if (isNaN(quantity) || quantity <= 0) { showStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ', 'error'); return; }

            showStatus('‚è≥ –í—ã–ø–æ–ª–Ω—è—é –æ–ø–µ—Ä–∞—Ü–∏—é —Å–ø–∏—Å–∞–Ω–∏—è...', 'loading');
            closeModals();

            try {
                const response = await fetch(`${API_URL}/${selectedProductId}/reduce`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ quantity })
                });
                if (!response.ok) {
                    const error = await response.json().catch(()=>({}));
                    throw new Error(error.error || error.message || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }
                const result = await response.json();
                if (result.success) {
                    showStatus(`‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–ø–∏—Å–∞–Ω–æ ${quantity} –µ–¥–∏–Ω–∏—Ü —Ç–æ–≤–∞—Ä–∞`, 'success');
                    loadProducts();
                } else {
                    throw new Error(result.error || result.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–ø–∏—Å–∞–Ω–∏–∏');
                }
            } catch (error) {
                showStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è
        async function performDelete() {
            if (!isUnlocked) { showStatus('‚ùå –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω', 'error'); closeModals(); return; }
            showStatus('‚è≥ –£–¥–∞–ª—è—é —Ç–æ–≤–∞—Ä –∏–∑ —Å–∏—Å—Ç–µ–º—ã...', 'loading');
            closeModals();
            try {
                const response = await fetch(`${API_URL}/${selectedProductId}`, { method: 'DELETE' });
                if (!response.ok) {
                    const error = await response.json().catch(()=>({}));
                    throw new Error(error.error || error.message || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }
                const result = await response.json();
                if (result.success) {
                    showStatus(`‚úÖ –¢–æ–≤–∞—Ä "${selectedProductName}" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω`, 'success');
                    loadProducts();
                } else {
                    throw new Error(result.error || result.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏');
                }
            } catch (error) {
                showStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        // –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (PUT)
        async function performEdit() {
            if (!isUnlocked) { showStatus('‚ùå –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω', 'error'); closeModals(); return; }
            const name = document.getElementById('editName').value.trim();
            const quantity = parseInt(document.getElementById('editQuantity').value);
            const category = document.getElementById('editCategory').value.trim();
            const price = parseFloat(document.getElementById('editPrice').value);

            if (!name) { showStatus('‚ùå –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ', 'error'); return; }
            if (isNaN(quantity) || quantity < 0) { showStatus('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ', 'error'); return; }
            if (isNaN(price) || price < 0) { showStatus('‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ü–µ–Ω–∞', 'error'); return; }

            showStatus('‚è≥ –û—Ç–ø—Ä–∞–≤–ª—è—é –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä...', 'loading');
            closeModals();
            try {
                const response = await fetch(`${API_URL}/${selectedProductId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, quantity, category, price })
                });
                if (!response.ok) {
                    const error = await response.json().catch(()=>({}));
                    throw new Error(error.error || error.message || '–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞');
                }
                const result = await response.json();
                if (result.success) {
                    showStatus('‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã', 'success');
                    loadProducts();
                } else {
                    throw new Error(result.error || result.message || '–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏');
                }
            } catch (error) {
                showStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–µ–π
        function closeModals() {
            closeModalById('reduceModal');
            closeModalById('deleteModal');
            closeModalById('editModal');
        }
        function openModal(id) {
            document.getElementById(id).style.display = 'flex';
        }
        function closeModalById(id) {
            const el = document.getElementById(id);
            if (el) el.style.display = 'none';
        }
        function closeEditModal() { closeModalById('editModal'); selectedProductId = null; }
        function closeUnlockModal() { closeModalById('unlockModal'); }
        function overlayClick(e) {
            if (e.target.classList.contains('modal-overlay')) {
                closeModals();
                closeUnlockModal();
            }
        }

        // –°—Ç–∞—Ç—É—Å-–±–∞—Ä
        function showStatus(message, type) {
            const statusBar = document.getElementById('statusBar');
            const statusIcon = document.getElementById('statusIcon');
            const statusText = document.getElementById('statusText');
            statusIcon.className = 'status-icon';
            statusText.className = 'status-text';
            switch(type) {
                case 'success':
                    statusIcon.innerHTML = '‚úÖ';
                    statusText.className += ' status-success';
                    break;
                case 'loading':
                    statusIcon.innerHTML = '‚è≥';
                    statusIcon.className += ' pulse';
                    statusText.className += ' status-loading';
                    break;
                case 'error':
                    statusIcon.innerHTML = '‚ùå';
                    statusText.className += ' status-error';
                    break;
                default:
                    statusIcon.innerHTML = '';
            }
            statusText.textContent = message;
            statusBar.style.display = 'flex';
            if (type === 'success') {
                setTimeout(()=>{ statusBar.style.display = 'none'; }, 3000);
            }
        }

        // Unlock modal controls
        function openUnlockModal() {
            document.getElementById('authName').value = '';
            document.getElementById('authPass').value = '';
            document.getElementById('unlockModal').style.display = 'flex';
        }

        function tryUnlock() {
            const name = document.getElementById('authName').value.trim();
            const pass = document.getElementById('authPass').value;
            // –í–ù–ò–ú–ê–ù–ò–ï: –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è (–¥–µ–º–æ)
            if (name === AUTH_NAME && pass === AUTH_PASS) {
                isUnlocked = true;
                updateUIState();
                closeUnlockModal();
                showStatus('‚úÖ –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤–∫–ª—é—á—ë–Ω', 'success');
            } else {
                showStatus('‚ùå –ù–µ–≤–µ—Ä–Ω–æ–µ –∏–º—è –∏–ª–∏ –ø–∞—Ä–æ–ª—å', 'error');
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫–∏ –≤ –ø–∞–Ω–µ–ª–∏ (–∫–æ–≥–¥–∞ –Ω–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–æ–≤–∞—Ä–∞)
        function showReduceModal() {
            if (!isUnlocked) { showStatus('‚ùå –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω', 'error'); return; }
            showStatus('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –¥–ª—è —Å–ø–∏—Å–∞–Ω–∏—è –∏–∑ —Å–ø–∏—Å–∫–∞', 'error');
        }
        function showDeleteModal() {
            if (!isUnlocked) { showStatus('‚ùå –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ –≤–∫–ª—é—á–µ–Ω', 'error'); return; }
            showStatus('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ —Å–ø–∏—Å–∫–∞', 'error');
        }

        // –ü—Ä–æ—Å—Ç–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤—ã–≤–æ–¥–∞: –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ç—Ä–æ–∫–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ escape
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ overlayClick

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ (–∫–æ–≥–¥–∞ —Ä–µ–∂–∏–º –∏–∑–º–µ–Ω–∏–ª—Å—è) ‚Äî –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º —Å–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è isUnlocked
        // –ö–æ–≥–¥–∞ —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º, –æ–±–Ω–æ–≤–∏–º –≤–∏–¥ –∫–Ω–æ–ø–æ–∫ –≤ —Å–ø–∏—Å–∫–µ
        // –ü–æ—ç—Ç–æ–º—É –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ isUnlocked —á–µ—Ä–µ–∑ setInterval –Ω–µ–±–æ–ª—å—à–æ–≥–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è:
        (function watchUnlock() {
            let prev = isUnlocked;
            setInterval(()=> {
                if (prev !== isUnlocked) {
                    prev = isUnlocked;
                    // –ø–µ—Ä–µ—Å–æ–∑–¥–∞—ë–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –≤—ã–±–æ—Ä–∫–∏
                    displayProducts(allProducts);
                    updateUIState();
                }
            }, 300);
        })();

        // Additional helpers
        function closeModalByName(modalId) { closeModalById(modalId); }

    </script>
</body>
</html>
